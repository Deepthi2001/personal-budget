<!DOCTYPE html>
<!-- This is an A11y Change 1 mentioning primary lang of webpage -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- This is an SEO Change 1 -->
    <meta name="description" content="Personal Budget - A free budgeting tool to stay on track with your finances efficiently!"> 

    <!-- This is an SEO Change 2 -->
    <meta name="keywords" content="budgeting app, personal finance, money management, expense tracking, free budget tool, financial planning">

    <!-- This is an SEO Change 3 -->
    <meta name="author" content="Saideepthi Jagarapu">

    <title>Personal Budget</title>
    <link rel="stylesheet" href="/reset.css">
    <link rel="stylesheet" href="/main.css">
</head>
<body>

     <!-- This is an A11y Change 2 -->
     <a href="#main-content" class="skip">Skip to content</a>

    <!-- Semantic HTML Change 1: replacing div with nav -->
        <nav class="menu">
            <ul>
                <li><a href="/">Homepage</a></li>
                <li><a href="/about.html">About</a></li>
                <li><a href="/login.html">Login</a></li>
                <!--
                This is an A11y Change 3 - Added aria-label to provide screen readers with context about the external link opening in a new tab
                -->
                <li><a href="https://google.com" target="_blank" rel="noopener noreferrer" 
                    aria-label="Visit Google (opens in a new tab)">Google</a></li>
            </ul>
        </nav>

        <!-- Semantic HTML Change 2: replacing div with header -->
        <header class="hero">
            <h1>Personal Budget</h1>
            <h2>A personal-budget management app</h2>
        </header>

        <!-- Semantic HTML Change 3: Replaced div with main for the main content --> 
        <main class="container center">

            <section class="page-area">

                <!-- This is an A11y Change 4 -->
                <!--
                Changing <h1> inside sections to <h2>
                - There should be only one <h1> per page (already used for the page title).
                - Using multiple <h1>s confuses screen readers and impacts SEO negatively.
                 -->
                <article class="text-box">
                    <h2>Stay on track</h2>
                    <p>
                        Do you know where you are spending your money? If you really stop to track it down,
                        you would get surprised! Proper budget management depends on real data... and this
                        app will help you with that!
                    </p>
                </article>
        
                <article class="text-box">
                    <h2>Alerts</h2>
                    <p>
                        What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    </p>
                </article>
        
                <article class="text-box">
                    <h2>Results</h2>
                    <p>
                        People who stick to a financial plan, budgeting every expense, get out of debt faster!
                        Also, they to live happier lives... since they expend without guilt or fear... 
                        because they know it is all good and accounted for.
                    </p>
                </article>
        
                <article class="text-box">
                    <h2>Free</h2>
                    <p>
                        This app is free!!! And you are the only one holding your data!
                    </p>
                </article>
        
                <article class="text-box">
                    <h2>Stay on track</h2>
                    <p>
                        Do you know where you are spending your money? If you really stop to track it down,
                        you would get surprised! Proper budget management depends on real data... and this
                        app will help you with that!
                    </p>
                </article>
        
                <article class="text-box">
                    <h2>Alerts</h2>
                    <p>
                        What if your clothing budget ended? You will get an alert. The goal is to never go over the budget.
                    </p>
                </article>
        
                <article class="text-box">
                    <h2>Results</h2>
                    <p>
                        People who stick to a financial plan, budgeting every expense, get out of debt faster!
                        Also, they to live happier lives... since they expend without guilt or fear... 
                        because they know it is all good and accounted for.
                    </p>
                </article>
        
                <article class="text-box" style="display: flex;">
                    <div>
                    <h2> Budget Chart</h2>
                    <p>
                        <canvas id="mySimpleChart"></canvas>
                    </p></div>

                    <div>
                        <h2>D3 Budget Chart</h2>
                    <div id="myd3Chart"></div>
                    </div>
                </article>
                
            </section>

        </div>
    </main>

    <!-- This is a Semantic HTML Change 4 - replacing footer with div -->

    <footer class="bottom">
        <div class="center">
            <!-- This is an A11y Change 5 -->
            <!-- 
            
            Adding aria-label to the copyright year
            Screen readers cannot interpret copyright symbols properly.
            aria-label="All rights reserved" provides clear meaning for screen readers.
            
            -->
            <p>&copy; <span aria-label="All rights reserved">All Rights Reserved 2025 </span>Saideepthi Jagarapu</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js" integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js" integrity="sha512-CQBWl4fJHWbryGE+Pc7UAxWMUMNMWzWxF4SQo9CgkJIN1kx6djDQZjh3Y8SZ1d+6I+1zze6Z7kHXO7q3UyZAWw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script>
        var dataSource = {
            datasets: [{
                data: [],
            }],

            labels: [
                'Rent',
                'Groceries',
                'Food'
            ],
            myBudget:[]
        };
        function createChart() {
            var ctx = document.getElementById("mySimpleChart").getContext("2d");
            var myPieChart = new Chart(ctx, {
                type: 'pie',
                data: dataSource
            });
        }

    function createD3jsChart() {
        var width = 400,
            height = 400,
            margin = 40,
            radius = Math.min(width, height) / 2 - margin;

        var svg = d3.select("#myd3Chart")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        var data = dataSource.myBudget;

        var color = d3.scaleOrdinal().range(d3.schemeDark2);

        var pie = d3.pie()
            .sort(null)
            .value(d => d.value.budget);

        var pie_data = pie(d3.entries(data));

        var arc = d3.arc()
            .innerRadius(radius * 0.45)
            .outerRadius(radius * 0.8);

        var outerArc = d3.arc()
            .innerRadius(radius * 0.9)
            .outerRadius(radius * 0.9);

        // Draw Pie Slices
        svg.selectAll("allSlices")
            .data(pie_data)
            .enter()
            .append("path")
            .attr("d", arc)
            .attr("fill", d => color(d.data.value.title))
            .attr("stroke", "white")
            .style("stroke-width", "2px")
            .style("opacity", 0.7);

        // Draw Polylines
        svg.selectAll("allPolylines")
            .data(pie_data)
            .enter()
            .append("polyline")
            .attr("stroke", "black")
            .style("fill", "none")
            .attr("stroke-width", 1)
            .attr("points", function (d) {
                var posA = arc.centroid(d);
                var posB = outerArc.centroid(d);
                var posC = outerArc.centroid(d);
                var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2;
                posC[0] = radius * 0.95 * (midangle < Math.PI ? 1 : -1);
                return [posA, posB, posC];
            });

        // Draw Labels
        svg.selectAll("allLabels")
            .data(pie_data)
            .enter()
            .append("text")
            .text(d => d.data.value.title)
            .attr("transform", function (d) {
                var pos = outerArc.centroid(d);
                var midangle = d.startAngle + (d.endAngle - d.startAngle) / 2;
                pos[0] = radius * 0.99 * (midangle < Math.PI ? 1 : -1);
                return "translate(" + pos + ")";
            })
            .style("text-anchor", d => (d.startAngle + (d.endAngle - d.startAngle) / 2 < Math.PI ? "start" : "end"));
    }

        function getBudget(){
            axios.get("/budget").then(function(res){
                console.log(res,"api response");
                for(var i=0;i<res.data.myBudget.length;i++){
                    dataSource.datasets[0].data[i] = res.data.myBudget[i].budget;
                    dataSource.labels[i]=res.data.myBudget[i].title;
                    dataSource.myBudget.push({
                        "title": res.data.myBudget[i].title,
                        "budget": res.data.myBudget[i].budget
                    })
                }
                console.log(dataSource,"dataSource");
                createChart();
                
                createD3jsChart();
            })
        }
        getBudget();
    </script>
</body>
</html>